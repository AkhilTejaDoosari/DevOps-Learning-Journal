# **05. Users & Groups — Managing System Access and Identity**
> Understanding who can access your system and how they're organized.

---

## Table of Contents
- [1. Why User Management Matters](#1-why-user-management-matters)
- [2. The Access Control Challenge](#2-the-access-control-challenge)
- [3. User and Group Architecture: Inside-Out](#3-user-and-group-architecture-inside-out)
- [4. Core Concepts](#4-core-concepts)
- [5. Real-World Scenarios](#5-real-world-scenarios)
- [6. Commands Toolbox](#6-commands-toolbox)
- [7. Quick Summary](#7-quick-summary)

---

<details>
<summary><strong>1. Why User Management Matters</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

Every production system is multi-user.

Whether it's:
- SSH access for developers
- Service accounts for applications
- Database users for backend services
- Admin accounts for operations

Understanding users and groups means:
- you can control who has access
- you can organize permissions logically
- you can troubleshoot access issues quickly
- you can implement least-privilege security

This isn't about memorizing commands.
It's about understanding how Linux identifies users, organizes them into groups, and controls access.

</div>

</details>

---

<details>
<summary><strong>2. The Access Control Challenge</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

Most access issues come from not understanding the user/group model.

**Common Problems:**
- "User can't access shared directory"
- "Application service account has wrong permissions"
- "Need to give multiple people the same access"
- "User deleted but files still owned by old UID"
- "Can't remember if user is in the right group"

**The Root Cause:**
Not understanding:
- how UIDs and GIDs work
- primary vs supplementary groups
- where user/group info is stored
- how sudo access is granted

**What This File Fixes:**
You'll master creating users and groups, understanding UIDs/GIDs, managing group membership, and knowing where identity information lives in the filesystem.

</div>

</details>

---

<details>
<summary><strong>3. User and Group Architecture: Inside-Out</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

Linux identifies users by numbers (UIDs), not names.

```
┌──────────────────────────────────────────┐
│   User Login (username: akhil)           │
└────────────┬─────────────────────────────┘
             │
┌────────────▼─────────────────────────────┐
│   System maps "akhil" → UID 1000         │
│   (from /etc/passwd)                     │
└────────────┬─────────────────────────────┘
             │
┌────────────▼─────────────────────────────┐
│   UID 1000 has:                          │
│   - Primary Group: UID 1000 (akhil)      │
│   - Supplementary Groups: docker, sudo   │
│   (from /etc/group)                      │
└────────────┬─────────────────────────────┘
             │
┌────────────▼─────────────────────────────┐
│   Kernel checks UID & GIDs for access    │
└──────────────────────────────────────────┘
```

**Key Insight:**
The kernel only sees numbers (UIDs and GIDs).
Usernames are just human-readable labels stored in `/etc/passwd`.

**UID Ranges:**

| Range      | Purpose                             |
|------------|-------------------------------------|
| `0`        | Root (superuser)                    |
| `1–200`    | System accounts & services          |
| `201–999`  | Unprivileged system processes       |
| `1000+`    | Regular user accounts               |

**Groups Work Similarly:**
- Every user has a **primary group** (usually same name as username)
- Users can belong to **supplementary groups** for additional access
- Groups organize users logically (docker, sudo, developers, etc.)

**Example:**
User `akhil` (UID 1000) is in:
- Primary group: `akhil` (GID 1000)
- Supplementary groups: `docker`, `sudo`, `www-data`

This means `akhil` has all permissions granted to those four groups.

</div>

</details>

---

<details>
<summary><strong>4. Core Concepts</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

### UG-001 — Understanding UIDs and GIDs

**UID (User ID):**
A unique number that identifies a user.

**GID (Group ID):**
A unique number that identifies a group.

**Why Numbers, Not Names?**
The kernel only understands numbers. Names are for humans.

**Checking Your UID:**
```bash copy
id
# Output: uid=1000(akhil) gid=1000(akhil) groups=1000(akhil),27(sudo),999(docker)
```

**Key Files:**
- `/etc/passwd` — maps usernames to UIDs
- `/etc/group` — maps group names to GIDs
- `/etc/shadow` — stores encrypted passwords (root-only)
- `/etc/gshadow` — stores encrypted group passwords (root-only)

**UID Ranges:**

| Range      | Purpose                             |
|------------|-------------------------------------|
| `0`        | Root (super-user)                   |
| `1–200`    | System accounts & services          |
| `201–999`  | Unprivileged system processes       |
| `1000+`    | Regular user accounts               |

---

### UG-002 — The /etc/passwd File

Contains user account information.

**Format:**
```
username:x:UID:GID:GECOS:home_directory:shell
```

**Example Entry:**
```
akhil:x:1000:1000:Akhil Teja:/home/akhil:/bin/bash
```

**Fields:**
1. `akhil` — username
2. `x` — password placeholder (actual password in /etc/shadow)
3. `1000` — UID
4. `1000` — primary GID
5. `Akhil Teja` — GECOS (full name, contact info)
6. `/home/akhil` — home directory
7. `/bin/bash` — default shell

**Viewing:**
```bash copy
cat /etc/passwd
```

**Finding Specific User:**
```bash copy
grep akhil /etc/passwd
```

---

### UG-003 — The /etc/group File

Contains group definitions and member lists.

**Format:**
```
groupname:x:GID:member1,member2
```

**Example Entry:**
```
docker:x:999:akhil,navya
```

**Fields:**
1. `docker` — group name
2. `x` — password placeholder (in /etc/gshadow)
3. `999` — GID
4. `akhil,navya` — members (comma-separated)

**Viewing:**
```bash copy
cat /etc/group
```

**Finding Groups for User:**
```bash copy
groups akhil
# Output: akhil sudo docker
```

---

### UG-004 — Creating Users

**`useradd` (Add User):**

**Basic (no home directory):**
```bash copy
sudo useradd navya
```

**With home directory (`-m`):**
```bash copy
sudo useradd -m navya
```

**With specific shell (`-s`):**
```bash copy
sudo useradd -m -s /bin/bash navya
```

**With specific UID (`-u`):**
```bash copy
sudo useradd -m -s /bin/bash -u 1500 navya
```

**Best Practice:**
Always use `-m` to create home directory.

**Complete User Creation:**
```bash copy
sudo useradd -m -s /bin/bash navya
sudo passwd navya
# Enter password when prompted
```

---

### UG-005 — Setting Passwords

**`passwd` (Set/Change Password):**

**For current user:**
```bash copy
passwd
```

**For another user (requires sudo):**
```bash copy
sudo passwd navya
```

**Why Passwords Matter:**
Without a password, the user account exists but can't log in.

---

### UG-006 — Checking User Identity

**`id` (Show User/Group IDs):**

**Current user:**
```bash copy
id
# Output: uid=1000(akhil) gid=1000(akhil) groups=1000(akhil),27(sudo),999(docker)
```

**Specific user:**
```bash copy
id navya
# Output: uid=1001(navya) gid=1001(navya) groups=1001(navya)
```

**Just UID:**
```bash copy
id -u akhil
# Output: 1000
```

**Just GID:**
```bash copy
id -g akhil
# Output: 1000
```

---

### UG-007 — Modifying Users

**`usermod` (Modify User):**

**Change shell:**
```bash copy
sudo usermod -s /bin/zsh navya
```

**Change UID:**
```bash copy
sudo usermod -u 2001 navya
```

**Change login name:**
```bash copy
sudo usermod -l newname oldname
```

**Add to supplementary group (`-aG`):**
```bash copy
sudo usermod -aG docker navya
```

**Important:** Always use `-aG` (append to groups), not `-G` (replace all groups).

---

### UG-008 — Deleting Users

**`userdel` (Delete User):**

**Delete user, keep home directory:**
```bash copy
sudo userdel navya
```

**Delete user and home directory:**
```bash copy
sudo userdel --remove navya
```

**Why Keep Home Directory?**
User files might be needed later. Delete only when certain.

---

### UG-009 — Creating Groups

**`groupadd` (Add Group):**

**Basic:**
```bash copy
sudo groupadd developers
```

**With specific GID:**
```bash copy
sudo groupadd -g 3000 developers
```

**Use Cases:**
- Organizing users by team (developers, ops, qa)
- Shared access to directories
- Application-specific permissions

---

### UG-010 — Modifying Groups

**`groupmod` (Modify Group):**

**Rename group:**
```bash copy
sudo groupmod -n engineers developers
```

**Change GID:**
```bash copy
sudo groupmod -g 2001 engineers
```

---

### UG-011 — Managing Group Membership

**`gpasswd` (Group Password/Membership):**

**Add user to group (`-a`):**
```bash copy
sudo gpasswd -a navya docker
```

**Remove user from group (`-d`):**
```bash copy
sudo gpasswd -d navya docker
```

**Alternative (using usermod):**
```bash copy
sudo usermod -aG docker navya
```

**Checking Membership:**
```bash copy
groups navya
# Output: navya docker
```

---

### UG-012 — Deleting Groups

**`groupdel` (Delete Group):**

```bash copy
sudo groupdel developers
```

**Caution:**
Can't delete a group if it's the primary group of any user.

---

### UG-013 — Primary vs Supplementary Groups

**Primary Group:**
- Every user has exactly one primary group
- Usually same name as username
- Set when user is created
- Used as default group for new files

**Supplementary Groups:**
- Additional groups user belongs to
- Used for access control
- User can be in many supplementary groups

**Example:**
```bash copy
id akhil
# Output: uid=1000(akhil) gid=1000(akhil) groups=1000(akhil),27(sudo),999(docker)
```

- Primary: `akhil` (GID 1000)
- Supplementary: `sudo` (GID 27), `docker` (GID 999)

---

### UG-014 — Understanding sudo (Concept)

**What is sudo?**
Allows permitted users to run commands as root (or another user).

**Why sudo?**
- Safer than logging in as root
- Auditable (logs who ran what)
- Granular (can allow specific commands only)

**Configuration:**
Controlled by `/etc/sudoers` file.
**Always edit with `visudo`, never directly.**

**Adding User to sudo Group:**
```bash copy
sudo usermod -aG sudo navya
```

On some systems (RHEL/CentOS):
```bash copy
sudo usermod -aG wheel navya
```

**Testing:**
```bash copy
sudo whoami
# Output: root
```

---

### UG-015 — GECOS Field

The GECOS field in `/etc/passwd` stores user metadata.

**Example:**
```
akhil:x:1000:1000:Akhil Teja,Engineering,555-1234:/home/akhil:/bin/bash
```

**Fields (comma-separated):**
1. Full name
2. Room number
3. Work phone
4. Home phone
5. Other

**Viewing:**
```bash copy
finger akhil
```

**Changing:**
```bash copy
sudo chfn akhil
```

**Why It Matters:**
Helps identify users on shared systems.

</div>

</details>

---

<details>
<summary><strong>5. Real-World Scenarios</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

### Scenario 1: New Developer Needs Access

**Symptom:**
New team member joining, needs server access.

**Cause:**
No user account exists.

**Fix:**
```bash copy
sudo useradd -m -s /bin/bash navya
sudo passwd navya
sudo usermod -aG sudo,docker navya
```

**Confirm:**
```bash copy
id navya
# Output shows UID, primary group, and supplementary groups (sudo, docker)
```

---

### Scenario 2: User Can't Run Docker Commands

**Symptom:**
User gets "permission denied" when running `docker ps`.

**Cause:**
User not in `docker` group.

**Fix:**
```bash copy
sudo usermod -aG docker navya
```

**Important:**
User must log out and back in for group changes to take effect.

**Confirm:**
```bash copy
groups navya
# Output: navya docker

# After navya logs back in:
docker ps
# Works without sudo
```

---

### Scenario 3: Service Account for Application

**Symptom:**
Application needs a dedicated user (not root, not personal account).

**Cause:**
Best practice: applications run as dedicated service accounts.

**Fix:**
```bash copy
sudo useradd -r -s /usr/sbin/nologin appuser
# -r creates system account (UID < 1000)
# -s /usr/sbin/nologin prevents interactive login
```

**Confirm:**
```bash copy
id appuser
# Output shows system UID range
```

---

### Scenario 4: Shared Directory for Team

**Symptom:**
Multiple developers need write access to `/var/www/html`.

**Cause:**
Need group-based permissions.

**Fix:**
```bash copy
sudo groupadd webdevs
sudo usermod -aG webdevs akhil
sudo usermod -aG webdevs navya
sudo chgrp webdevs /var/www/html
sudo chmod 775 /var/www/html
```

**Confirm:**
```bash copy
ls -ld /var/www/html
# Output: drwxrwxr-x ... webdevs ...
```

---

### Scenario 5: User Left Company, Cleanup Needed

**Symptom:**
Former employee still has account on servers.

**Cause:**
Security risk, need to remove access.

**Fix:**
```bash copy
# First, lock the account
sudo passwd -l olduser

# Archive their home directory
sudo tar -czf /backups/olduser_home.tar.gz /home/olduser

# Delete the user
sudo userdel --remove olduser
```

**Confirm:**
```bash copy
id olduser
# Output: id: 'olduser': no such user
```

---

### Scenario 6: Forgot Which Groups User Belongs To

**Symptom:**
Need to verify user's group memberships for troubleshooting.

**Cause:**
User has access issues, need to check groups.

**Fix:**
```bash copy
groups navya
# OR
id navya
```

**Confirm:**
Output shows all groups user belongs to.

</div>

</details>

---

<details>
<summary><strong>6. Commands Toolbox</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

```bash copy
id   # show current user's UID, GID, and groups
```

```bash copy
id username   # show specific user's UID, GID, and groups
```

```bash copy
id -u   # show just UID
```

```bash copy
id -g   # show just primary GID
```

```bash copy
whoami   # show current username
```

```bash copy
groups   # show groups current user belongs to
```

```bash copy
groups username   # show groups for specific user
```

```bash copy
cat /etc/passwd   # view all user accounts
```

```bash copy
grep username /etc/passwd   # find specific user entry
```

```bash copy
cat /etc/group   # view all groups
```

```bash copy
grep groupname /etc/group   # find specific group entry
```

```bash copy
sudo useradd username   # create user (no home directory)
```

```bash copy
sudo useradd -m username   # create user with home directory
```

```bash copy
sudo useradd -m -s /bin/bash username   # create user with home and shell
```

```bash copy
sudo useradd -m -s /bin/bash -u 1500 username   # create user with specific UID
```

```bash copy
sudo passwd username   # set or change user password
```

```bash copy
sudo usermod -s /bin/zsh username   # change user's shell
```

```bash copy
sudo usermod -u 2001 username   # change user's UID
```

```bash copy
sudo usermod -l newname oldname   # change login name
```

```bash copy
sudo usermod -aG groupname username   # add user to supplementary group
```

```bash copy
sudo userdel username   # delete user (keep home directory)
```

```bash copy
sudo userdel --remove username   # delete user and home directory
```

```bash copy
sudo groupadd groupname   # create group
```

```bash copy
sudo groupadd -g 3000 groupname   # create group with specific GID
```

```bash copy
sudo groupmod -n newname oldname   # rename group
```

```bash copy
sudo groupmod -g 2001 groupname   # change group GID
```

```bash copy
sudo gpasswd -a username groupname   # add user to group
```

```bash copy
sudo gpasswd -d username groupname   # remove user from group
```

```bash copy
sudo groupdel groupname   # delete group
```

```bash copy
visudo   # safely edit sudoers file
```

</div>

</details>

---

<details>
<summary><strong>7. Quick Summary</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

- Linux identifies users by UID (number), not username
- Every user has a primary group and can belong to supplementary groups
- `/etc/passwd` maps usernames to UIDs, `/etc/group` maps groups to GIDs
- `/etc/shadow` stores encrypted passwords (root-only)
- Use `useradd -m` to create users with home directories
- Use `passwd` to set passwords
- Use `usermod -aG` to add users to groups (append, don't replace)
- Use `id` and `groups` to check user identity and memberships
- sudo access controlled by `/etc/sudoers` (edit with `visudo`)
- Service accounts should use system UIDs (<1000) and nologin shell
- Always lock or delete accounts when employees leave

**What's Next:**
Now that you understand users and groups, the next file covers permissions and ownership — controlling what users can actually do with files and directories.

</div>

</details>

---