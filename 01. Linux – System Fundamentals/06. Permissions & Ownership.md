# **06. Permissions & Ownership — Controlling File Access**
> Understanding who can read, write, and execute — the foundation of Linux security.

---

## Table of Contents
- [1. Why Permissions Matter](#1-why-permissions-matter)
- [2. The Permission Confusion](#2-the-permission-confusion)
- [3. Permission Model: Inside-Out](#3-permission-model-inside-out)
- [4. Core Concepts](#4-core-concepts)
- [5. Real-World Scenarios](#5-real-world-scenarios)
- [6. Commands Toolbox](#6-commands-toolbox)
- [7. Quick Summary](#7-quick-summary)

---

<details>
<summary><strong>1. Why Permissions Matter</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

Every file security issue traces back to permissions.

Whether it's:
- Application can't read config file
- User accidentally deletes shared directory
- Script can't execute
- Log file exposed to wrong users

Understanding permissions means:
- you can troubleshoot access issues instantly
- you can implement least-privilege security
- you can protect sensitive files confidently
- you can share resources safely

This isn't about memorizing octal numbers.
It's about understanding how Linux controls access at the file level.

</div>

</details>

---

<details>
<summary><strong>2. The Permission Confusion</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

Most access issues come from not understanding the permission model.

**Common Problems:**
- "Script won't run — permission denied"
- "User can see file but can't edit it"
- "Directory readable but can't cd into it"
- "Changed permissions but it broke the application"
- "What does `chmod 755` actually mean?"

**The Root Cause:**
Not understanding:
- read/write/execute mean different things for files vs directories
- owner vs group vs others
- octal vs symbolic notation
- special bits (SUID, SGID, sticky)
- how umask affects default permissions

**What This File Fixes:**
You'll master chmod, chown, understand r/w/x completely, know when to use special bits, and confidently set permissions for any scenario.

</div>

</details>

---

<details>
<summary><strong>3. Permission Model: Inside-Out</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

Linux permissions are organized in three layers:

```
┌──────────────────────────────────────────┐
│   User tries to access file              │
└────────────┬─────────────────────────────┘
             │
┌────────────▼─────────────────────────────┐
│   Kernel checks:                         │
│   1. Are you the owner?                  │
│      → Use OWNER permissions             │
│   2. Are you in the group?               │
│      → Use GROUP permissions             │
│   3. Neither?                            │
│      → Use OTHERS permissions            │
└────────────┬─────────────────────────────┘
             │
┌────────────▼─────────────────────────────┐
│   For each category, check bits:         │
│   r (read)    = 4                        │
│   w (write)   = 2                        │
│   x (execute) = 1                        │
└────────────┬─────────────────────────────┘
             │
┌────────────▼─────────────────────────────┐
│   Access granted or denied               │
└──────────────────────────────────────────┘
```

**Permission Structure:**

```
-rwxr-xr--
│└┬┘└┬┘└┬┘
│ │  │  └─ others: r-- (4)
│ │  └──── group:  r-x (5)
│ └─────── owner:  rwx (7)
└───────── type:   - (regular file)
```

**Key Insight:**
Kernel checks categories in order: owner → group → others.
**First match wins.**

**Example:**
File owned by `akhil`, group `developers`, permissions `640`:
- `akhil` gets `rw-` (6) — owner permissions
- Members of `developers` get `r--` (4) — group permissions
- Everyone else gets `---` (0) — no access

**If `akhil` is in `developers` group:**
Still uses owner permissions (6), NOT group permissions (4).

</div>

</details>

---

<details>
<summary><strong>4. Core Concepts</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

### PERM-001 — Permission Triads

Every file has three permission sets (triads):

```
USER    GROUP    OTHERS
r w x   r w x   r w x
```

**Ownership:**
Each file has an **owner** (user) and a **group**.

**Permission Bits:**
- `r` (read) = 4
- `w` (write) = 2
- `x` (execute) = 1

**Calculating Octal:**

| Octal | Symbolic | Calculation      | Meaning               |
|:-----:|:--------:|------------------|-----------------------|
| 0     | `---`    | 0                | none                  |
| 1     | `--x`    | 2⁰ = 1           | execute only          |
| 2     | `-w-`    | 2¹ = 2           | write only            |
| 3     | `-wx`    | 2¹+2⁰ = 3        | write+execute         |
| 4     | `r--`    | 2² = 4           | read only             |
| 5     | `r-x`    | 2²+2⁰ = 5        | read+execute          |
| 6     | `rw-`    | 2²+2¹ = 6        | read+write            |
| 7     | `rwx`    | 2²+2¹+2⁰ = 7     | read+write+execute    |

**Example:**
```bash copy
chmod 644 file.txt
# 6 (rw-) owner
# 4 (r--) group
# 4 (r--) others
```

---

### PERM-002 — What Read/Write/Execute Mean

**For Regular Files:**

| Permission | Meaning                              |
|------------|--------------------------------------|
| `r` (read) | View file contents                   |
| `w` (write)| Modify file contents                 |
| `x` (execute)| Run file as program/script         |

**For Directories:**

| Permission | Meaning                              |
|------------|--------------------------------------|
| `r` (read) | List directory contents (`ls`)       |
| `w` (write)| Create/delete files inside           |
| `x` (execute)| Enter directory (`cd`)             |

**Critical for Directories:**
- `r` without `x`: can list files but can't `cd` or access them
- `x` without `r`: can `cd` if you know the path, but can't list files
- `w` without `x`: meaningless (can't create files if can't enter)

**Common Directory Permissions:**
- `755` (`rwxr-xr-x`) — owner full, others read+execute
- `750` (`rwxr-x---`) — owner full, group read+execute, others none
- `700` (`rwx------`) — owner only

---

### PERM-003 — chmod (Change Mode)

**Symbolic Mode:**
Modify with `u` (user), `g` (group), `o` (other), `a` (all) plus `+`/`-`/`=`.

**Add Permission:**
```bash copy
chmod u+x script.sh      # add execute for owner
chmod g+w file.txt       # add write for group
chmod o+r file.txt       # add read for others
chmod a+x script.sh      # add execute for all
```

**Remove Permission:**
```bash copy
chmod u-x script.sh      # remove execute from owner
chmod g-w file.txt       # remove write from group
chmod o-r file.txt       # remove read from others
```

**Set Exact Permission:**
```bash copy
chmod u=rw file.txt      # owner gets read+write only
chmod g=r file.txt       # group gets read only
chmod o= file.txt        # others get nothing
```

**Octal Mode:**
Three digits for owner/group/others.

```bash copy
chmod 644 file.txt       # rw-r--r--
chmod 755 script.sh      # rwxr-xr-x
chmod 600 secret.txt     # rw-------
chmod 777 file.txt       # rwxrwxrwx (dangerous!)
```

**Recursive (`-R`):**
```bash copy
chmod -R 755 /var/www
# Sets permissions on directory and all contents
```

---

### PERM-004 — chown (Change Owner)

**Change Owner:**
```bash copy
sudo chown akhil file.txt
```

**Change Owner and Group:**
```bash copy
sudo chown akhil:developers file.txt
```

**Change Just Group:**
```bash copy
sudo chgrp developers file.txt
```

**Recursive:**
```bash copy
sudo chown -R akhil:developers /var/www/html
```

**Why sudo?**
Only root (or file owner in some cases) can change ownership.

---

### PERM-005 — Interpreting ls -l

```bash copy
ls -l file.txt
# Output: -rw-r--r-- 1 akhil developers 1234 Jan 15 10:00 file.txt
```

**Breaking it down:**

```
-rw-r--r--  1  akhil  developers  1234  Jan 15 10:00  file.txt
│└─┬──┘└─┬──┘└─┬──┘  │    │         │       │           │
│  │     │     │     │    │         │       │           └─ filename
│  │     │     │     │    │         │       └───────────── timestamp
│  │     │     │     │    │         └───────────────────── size (bytes)
│  │     │     │     │    └─────────────────────────────── owner
│  │     │     │     └──────────────────────────────────── group
│  │     │     └────────────────────────────────────────── others: r--
│  │     └──────────────────────────────────────────────── group: r--
│  └────────────────────────────────────────────────────── owner: rw-
└───────────────────────────────────────────────────────── type: regular file
```

**File Type Indicators:**
- `-` regular file
- `d` directory
- `l` symbolic link
- `b` block device
- `c` character device
- `p` named pipe
- `s` socket

**Link Count:**
Number of hard links pointing to this inode.

---

### PERM-006 — Common Permission Patterns

**Files:**

| Pattern | Octal | Use Case                        |
|---------|-------|---------------------------------|
| `rw-------` | 600 | Private files (secrets, keys) |
| `rw-r--r--` | 644 | Shared read-only files        |
| `rw-rw-r--` | 664 | Group-editable files          |
| `rwxr-xr-x` | 755 | Public executables/scripts    |
| `rwx------` | 700 | Private executables           |

**Directories:**

| Pattern | Octal | Use Case                        |
|---------|-------|---------------------------------|
| `rwx------` | 700 | Private directory             |
| `rwxr-xr-x` | 755 | Public directory (most common)|
| `rwxrwxr-x` | 775 | Group-writable directory      |
| `rwxrwxrwt` | 1777| Shared temp (with sticky bit) |

---

### PERM-007 — SUID (Set User ID)

**What it does:**
When an executable has SUID, it runs with the **file owner's** privileges, not the user running it.

**Example:**
`/usr/bin/passwd` has SUID so any user can change their password (requires writing to root-owned `/etc/shadow`).

**Setting SUID:**
```bash copy
chmod u+s executable
# OR
chmod 4755 executable
```

**Visual:**
```bash copy
ls -l /usr/bin/passwd
# Output: -rwsr-xr-x ... (note 's' instead of 'x')
```

**Security Risk:**
SUID executables run as owner. If owner is root and executable is vulnerable, it's dangerous.

**Use Cases:**
- System utilities that need elevated privileges
- Password changes
- Network tools

---

### PERM-008 — SGID (Set Group ID)

**For Executables:**
Runs with the **file's group** privileges.

**For Directories:**
New files inherit the **directory's group**, not creator's primary group.

**Setting SGID:**
```bash copy
chmod g+s directory
# OR
chmod 2755 directory
```

**Use Case:**
Shared project directories where all files should belong to project group.

**Example:**
```bash copy
sudo mkdir /shared/projects
sudo chgrp developers /shared/projects
sudo chmod 2775 /shared/projects
```

Now any file created in `/shared/projects` automatically belongs to `developers` group.

---

### PERM-009 — Sticky Bit

**What it does:**
On a directory, only the **file owner**, **directory owner**, or **root** can delete or rename files inside.

**Use Case:**
Shared directories like `/tmp` where everyone can create files but can't delete others' files.

**Setting Sticky Bit:**
```bash copy
chmod +t directory
# OR
chmod 1777 directory
```

**Visual:**
```bash copy
ls -ld /tmp
# Output: drwxrwxrwt ... (note 't' at end)
```

**If others don't have execute:**
```bash copy
chmod 1776 directory
ls -ld directory
# Output: drwxrwxrwT ... (note 'T' — uppercase)
```

**Example:**
```bash copy
sudo mkdir /shared/temp
sudo chmod 1777 /shared/temp
```

Now:
- Anyone can create files
- Only file owner can delete their own files

---

### PERM-010 — Special Permission Numeric Prefix

| Bit    | Numeric | Effect                                                 |
|--------|---------|--------------------------------------------------------|
| SUID   | 4xxx    | Executable runs as file owner                          |
| SGID   | 2xxx    | Dir: new items inherit dir's group; exec runs as group |
| Sticky | 1xxx    | Dir: only owner/root can delete inside                 |

**Examples:**
```bash copy
chmod 4755 file    # SUID + rwxr-xr-x
chmod 2755 dir     # SGID + rwxr-xr-x
chmod 1777 dir     # Sticky + rwxrwxrwx
chmod 6755 file    # SUID + SGID + rwxr-xr-x
```

---

### PERM-011 — umask (Default Permissions)

**What it does:**
Controls default permissions for newly created files and directories.

**Default Starting Points:**
- Files: `666` (rw-rw-rw-)
- Directories: `777` (rwxrwxrwx)

**umask subtracts from these defaults.**

**Common umask Values:**

| umask | File Result | Dir Result | Description              |
|-------|-------------|------------|--------------------------|
| 022   | 644         | 755        | Standard (most distros)  |
| 027   | 640         | 750        | Group-readable only      |
| 077   | 600         | 700        | Private (owner only)     |

**Viewing umask:**
```bash copy
umask
# Output: 0022
```

**Setting umask (temporary):**
```bash copy
umask 027
```

**Setting umask (permanent):**
Add to `~/.bashrc`:
```bash copy
echo 'umask 027' >> ~/.bashrc
source ~/.bashrc
```

**Testing:**
```bash copy
umask 077
touch testfile
ls -l testfile
# Output: -rw------- (600)
```

---

### PERM-012 — ACLs (Access Control Lists)

**What are ACLs?**
Fine-grained permissions beyond owner/group/others.
Allow multiple users and groups with different permissions on same file.

**Installing ACL Support:**
```bash copy
sudo apt install acl
```

**Viewing ACLs:**
```bash copy
getfacl filename
```

**Setting ACL for User:**
```bash copy
setfacl -m u:navya:rw filename
# Grants navya read+write access
```

**Setting ACL for Group:**
```bash copy
setfacl -m g:developers:rx directory
# Grants developers group read+execute on directory
```

**Removing ACL:**
```bash copy
setfacl -x u:navya filename
```

**Setting Default ACL (for directories):**
```bash copy
setfacl -d -m g:developers:rwx /shared/projects
# New files in directory inherit this ACL
```

**Removing All ACLs:**
```bash copy
setfacl -b filename
```

**Use Cases:**
- Multiple users need different access to same file
- Project directories with complex team structures
- Shared resources with granular control

---

### PERM-013 — Inodes and Links (Permission Context)

**Inode:**
Metadata storage containing:
- Permissions
- Owner and group
- Timestamps
- File size
- Pointer to data blocks

**Hard Link:**
Points to same inode (shares permissions, owner, timestamps).

**Symbolic Link:**
Points to filename (has its own minimal permissions).

**Viewing Inodes:**
```bash copy
ls -li
# Shows inode number in first column
```

**Why This Matters for Permissions:**
- Hard links share permissions (change one, changes all)
- Symlinks have their own permissions but usually ignored (target permissions matter)

</div>

</details>

---

<details>
<summary><strong>5. Real-World Scenarios</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

### Scenario 1: Script Won't Execute

**Symptom:**
Running `./deploy.sh` gives "Permission denied".

**Cause:**
Missing execute permission.

**Fix:**
```bash copy
chmod u+x deploy.sh
./deploy.sh
```

**Confirm:**
```bash copy
ls -l deploy.sh
# Output: -rwxr--r-- ... (x for owner)
```

---

### Scenario 2: Web Directory Access Issues

**Symptom:**
Nginx can't serve files from `/var/www/html`.

**Cause:**
Wrong ownership or permissions.

**Fix:**
```bash copy
sudo chown -R www-data:www-data /var/www/html
sudo chmod -R 755 /var/www/html
```

**Confirm:**
```bash copy
ls -ld /var/www/html
# Output: drwxr-xr-x ... www-data www-data
```

---

### Scenario 3: Shared Project Directory

**Symptom:**
Team members can't edit each other's files in shared directory.

**Cause:**
Need SGID and group permissions.

**Fix:**
```bash copy
sudo mkdir /shared/project
sudo chgrp developers /shared/project
sudo chmod 2775 /shared/project
```

**Confirm:**
```bash copy
ls -ld /shared/project
# Output: drwxrwsr-x ... developers (note 's')

touch /shared/project/testfile
ls -l /shared/project/testfile
# Output shows 'developers' group (inherited)
```

---

### Scenario 4: Secure SSH Key

**Symptom:**
SSH refuses to use private key, says permissions too open.

**Cause:**
Private keys must be readable only by owner.

**Fix:**
```bash copy
chmod 600 ~/.ssh/id_rsa
```

**Confirm:**
```bash copy
ls -l ~/.ssh/id_rsa
# Output: -rw------- (600)
```

---

### Scenario 5: Temp Directory with Sticky Bit

**Symptom:**
Users deleting each other's files in shared temp directory.

**Cause:**
Need sticky bit protection.

**Fix:**
```bash copy
sudo mkdir /shared/temp
sudo chmod 1777 /shared/temp
```

**Confirm:**
```bash copy
ls -ld /shared/temp
# Output: drwxrwxrwt ... (note 't')

# Test: users can create but only delete own files
```

---

### Scenario 6: Fine-Grained Access with ACL

**Symptom:**
Need to give `navya` read access to file without changing group.

**Cause:**
Traditional permissions too coarse.

**Fix:**
```bash copy
setfacl -m u:navya:r report.pdf
```

**Confirm:**
```bash copy
getfacl report.pdf
# Output shows ACL entry for navya
```

---

### Scenario 7: Restrictive Default Permissions

**Symptom:**
New files should be private by default.

**Cause:**
Need restrictive umask.

**Fix:**
```bash copy
umask 077
echo 'umask 077' >> ~/.bashrc
```

**Confirm:**
```bash copy
touch newfile
ls -l newfile
# Output: -rw------- (600)
```

</div>

</details>

---

<details>
<summary><strong>6. Commands Toolbox</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

```bash copy
ls -l   # view detailed file permissions
```

```bash copy
ls -ld directory   # view directory permissions
```

```bash copy
ls -li   # view with inode numbers
```

```bash copy
chmod u+x file   # add execute for owner (symbolic)
```

```bash copy
chmod g+w file   # add write for group
```

```bash copy
chmod o-r file   # remove read from others
```

```bash copy
chmod a+x file   # add execute for all
```

```bash copy
chmod 644 file   # set exact permissions (octal)
```

```bash copy
chmod 755 script   # common script permissions
```

```bash copy
chmod 600 secret   # private file
```

```bash copy
chmod -R 755 /var/www   # recursive chmod
```

```bash copy
sudo chown user file   # change owner
```

```bash copy
sudo chown user:group file   # change owner and group
```

```bash copy
sudo chgrp group file   # change group only
```

```bash copy
sudo chown -R user:group directory   # recursive chown
```

```bash copy
chmod u+s executable   # set SUID
```

```bash copy
chmod g+s directory   # set SGID
```

```bash copy
chmod +t directory   # set sticky bit
```

```bash copy
chmod 4755 file   # SUID + rwxr-xr-x
```

```bash copy
chmod 2775 directory   # SGID + rwxrwxr-x
```

```bash copy
chmod 1777 directory   # sticky + rwxrwxrwx
```

```bash copy
umask   # view current umask
```

```bash copy
umask 027   # set umask temporarily
```

```bash copy
echo 'umask 027' >> ~/.bashrc   # persist umask
```

```bash copy
getfacl filename   # view ACLs
```

```bash copy
setfacl -m u:user:rwx file   # add user ACL
```

```bash copy
setfacl -m g:group:rx directory   # add group ACL
```

```bash copy
setfacl -x u:user file   # remove user ACL
```

```bash copy
setfacl -d -m g:group:rwx dir   # set default ACL
```

```bash copy
setfacl -b file   # remove all ACLs
```

```bash copy
stat filename   # view detailed file metadata including permissions
```

</div>

</details>

---

<details>
<summary><strong>7. Quick Summary</strong></summary>

<div style="margin-left: 16px; margin-right: 16px; margin-top: 8px; margin-bottom: 8px;">

- Permissions organized as owner/group/others with r/w/x bits
- Octal notation: r=4, w=2, x=1 (755 = rwxr-xr-x)
- For files: r=read, w=write, x=execute
- For directories: r=list, w=create/delete, x=enter
- Kernel checks owner first, then group, then others (first match wins)
- `chmod` changes permissions, `chown` changes ownership
- SUID (4xxx): run executable as file owner
- SGID (2xxx): inherit directory's group for new files
- Sticky bit (1xxx): only owner can delete files in directory
- umask controls default permissions for new files
- ACLs provide fine-grained access beyond owner/group/others
- Common patterns: 644 (files), 755 (dirs/scripts), 600 (secrets)

**What's Next:**
Now that you understand permissions and ownership, the next file covers processes and system information — monitoring what's running and how the system performs.

</div>

</details>

---